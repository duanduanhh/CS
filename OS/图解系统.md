# 内存管理

## 虚拟内存

**作用：**

- 使得进程的运行内存超过物理内存大小，不经常使用的内存可以换出到物理内存之外。
- 每个进程的虚拟内存空间相互独立，解决了多进程之间地址冲突问题。
- 页表项除了物理地址外还有一些标记属性的比特，比如读写权限、存在位等。为访问内存提供更好的安全性。

## 申请空间

- 32位操作系统中，1G内核空间、3G用户空间，进程理论上最大能申请3G大小的虚拟内存。
- 64位操作系统中，内核空间与用户空间都为128T，其他部分为未定义的空间。即使物理内存只有4G，申请8G的虚拟内存也是可以的。如果这块虚拟内存被访问了，要看系统有没有swap分区：
  - 没有swap分区，因为物理空间不够，会触发OOM，导致进程被kill。
  - 有swap分区，即使物理内存只有4G，程序可以正常使用8G的内存。

## LRU优化

**预读失效**

- Linux OS: active list, inactive list
- MySql Innodb: young, old

**缓存污染**

- Linux OS: 在内存页被访问第二次时，才将页从 inactive list 移动至 active list
- MySQL Innodb: 在内存也被访问第二次时，对停留在old区域的时间判断：
  - 间隔小于1S（默认1S），则不会移动至young
  - 间隔大于1S，则从old移动至young

# 进程管理

## 进程通信方式

**管道**

- 匿名管道 | 
  - 通信范围局限于父子关系的进程。管道没有实体（管道文件），只能通过fork复制父进程fd文件描述符，来达到通信的目的。
- 命名管道 FIFO

**消息队列**

- 存在用户态与内核态之间的数据拷贝开销，因为数据在内核中传输

**共享内存**

- 进程拿出一块虚拟地址空间，映射到相同的物理内存中

**信号量**

- 整型计数器，主要用于实现进程间的互斥和同步，而不是缓存进程间通信的数据（P、V 操作）

**信号**

- 执行默认操作
- 捕捉
- 忽略
- SIGKILL和SIGSTOP不可捕捉或忽略

**socket**

- init
- bind
- listen
- accept
- connect
- wirte - read

## 多线程冲突